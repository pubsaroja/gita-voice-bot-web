<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Bhagavad Gita Bot</title>
      <meta name="description" content="Explore Bhagavad Gita shlokas in Telugu with SGS and Sringeri styles, featuring audio recitations and meanings.">
      <meta name="keywords" content="Bhagavad Gita, SGS, Sringeri, Telugu shlokas, audio recitation, spiritual app">
      <meta name="author" content="Dr. P. Udayabhaskar">
      <meta name="robots" content="index, follow">
      <link rel="canonical" href="https://pubsaroja.github.io/bhagavad-gita-bot/">
      <link href="https://fonts.googleapis.com/css2?family=Ramabhadra&family=Outfit:wght@300&family=Noto+Sans+Telugu&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="https://unpkg.com/intro.js/minified/introjs.min.css">
      <script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>
      <style>
         :root{--bg-color:#f0f0f0;--text-color:#2c3e50;--card-bg:#ffffff;--card-border:#357EC7;--button-bg:#357EC7;--button-text:#ffffff;--button-hover-bg:#1e40af;--header-color:#2c3e50;--subheader-color:#34495e;}
         [data-theme="dark"]{--bg-color:#1a1a1a;--text-color:#ffffff;--card-bg:#2a2a2a;--card-border:#4a90e2;--button-bg:#4a90e2;--button-hover-bg:#357abd;--header-color:#ffffff;--subheader-color:#cccccc;}
         *,*::before,*::after{box-sizing:border-box;}
         body{font-family:Outfit,sans-serif;text-align:center;padding:20px;margin:0;background:var(--bg-color);color:var(--text-color);transition:all .3s;}
         h1{color:var(--header-color);font-size:1.8em;} h2{font-size:1em;color:var(--subheader-color);}
         .theme-toggle{position:fixed;top:10px;right:10px;display:flex;gap:10px;z-index:1001;}
         .theme-toggle button{background:none;border:none;font-size:24px;cursor:pointer;opacity:0.7;}
         .theme-toggle button.active{opacity:1;}
         .page-frame{max-width:900px;margin:10px auto;padding:15px;border:2px solid var(--card-border);border-radius:12px;background:var(--card-bg);box-shadow:0 4px 12px rgba(0,0,0,.1);}
         @media(max-width:600px){.page-frame{margin:5px;padding:12px;border-width:3px;}}
         .top-buttons{display:flex;justify-content:center;gap:12px;margin:20px auto;flex-wrap:wrap;}
         .top-buttons button{width:150px;height:150px;border-radius:50%;border:none;background:var(--button-bg);color:white;font-size:18px;cursor:pointer;background-repeat:no-repeat;background-position:center;background-size:80%;}
         .top-buttons button.sgs-button:hover{background-image:url('https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/main/sankhu.png');background-color:transparent;color:transparent;}
         .top-buttons button.sringeri-button:hover,.top-buttons button.third-paada-button:hover{background-image:url('https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/main/chakra.png');background-color:transparent;color:transparent;}
         @media(max-width:600px){.top-buttons button{font-size:1.1em!important;}}
         .continuous-play-box{margin:25px auto;max-width:600px;padding:20px;background:var(--card-bg);border:2px solid var(--card-border);border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
         audio#audioPlayer{margin:15px auto;display:block;width:90%;max-width:500px;}
         .radio-group,.language-group{display:flex;flex-wrap:wrap;justify-content:center;gap:15px;margin:15px 0;}
         .textbox-container{max-width:600px;margin:20px auto;padding:15px;border:2px solid var(--card-border);border-radius:10px;background:var(--card-bg);}
         .textbox-label{font-weight:bold;margin-bottom:8px;display:none;color:var(--header-color);}
         .textbox-label.active{display:block;}
         .shloka-text{font-size:1.5em;line-height:1.7;white-space:pre-line;text-align:center;padding:10px;min-height:120px;}
         @media(max-width:600px){.shloka-text{font-size:1.25em;}}
         .player-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:10px;margin:15px auto;max-width:500px;}
         .player-container button{padding:12px;font-size:16px;border:none;border-radius:25px;background:var(--button-bg);color:white;cursor:pointer;}
         .dropdown-container{max-width:600px;margin:20px auto;padding:15px;border:2px solid var(--card-border);border-radius:10px;}
         select{width:100%;padding:10px;font-size:1em;border-radius:8px;}
         .credits{font-size:0.9em;margin-top:30px;color:var(--subheader-color);}
      </style>
   </head>
   <body>
      <div class="theme-toggle">
         <button class="active" data-theme="light">Light</button>
         <button data-theme="dark">Dark</button>
      </div>

      <div class="page-frame">
         <h1>Srimad Bhagavad Gita</h1>
         <p>Listen, understand and memorize Bhagavad Gita shlokas</p>

         <div class="top-buttons">
            <button class="sgs-button" onclick="sendCommand('SGSFirstPaada')">1st Paada<br>Only</button>
            <button class="sringeri-button" onclick="sendCommand('SringeriPaada')">1st or 3rd Paada</button>
            <button class="third-paada-button" onclick="sendCommand('ThirdPaada')">3rd Paada<br>Only</button>
         </div>

         <!-- Continuous Play Options -->
         <div class="continuous-play-box">
            <strong style="font-size:1.35em;color:var(--header-color);">Continuous Random Play</strong><br><br>
            <label style="cursor:pointer;font-size:1.15em;"><input type="radio" name="continuousGap" id="gap30" value="30"> 30-second gap</label>
            <label style="cursor:pointer;font-size:1.15em;"><input type="radio" name="continuousGap" id="gap60" value="60"> 60-second gap</label>
            <br><br>
            <button id="stopContinuousBtn" style="display:none;background:#d32f2f;color:white;padding:11px 28px;border:none;border-radius:10px;font-size:1.1em;font-weight:bold;cursor:pointer;">
               Stop Continuous Play
            </button>
            <br><br>
            <small style="color:var(--subheader-color);font-style:italic;">Applies only to the 3 top buttons</small>
         </div>

         <audio id="audioPlayer" controls></audio>

         <div class="radio-group">
            <label>Style:</label>
            <input type="radio" name="style" value="sgs" id="sgs" onchange="updateTextboxVisibility()"> <label for="sgs">SGS</label>
            <input type="radio" name="style" value="sringeri" id="sringeri" checked onchange="updateTextboxVisibility()"> <label for="sringeri">Sringeri</label>
         </div>

         <div style="max-width:600px;margin:20px auto;padding:0 10px;">
            <div class="language-group">
               <label><input type="checkbox" id="telugu" checked> తెలుగు</label>
               <label><input type="checkbox" id="devanagari"> देवनागरी</label>
               <label><input type="checkbox" id="english"> English</label>
               <label><input type="checkbox" id="kannada"> ಕನ್ನಡ</label>
               <label><input type="checkbox" id="tamil"> தமிழ்</label>
            </div>
         </div>

         <div class="textbox-container">
            <div><div id="sgsLabel" class="textbox-label">SGS Style Shloka</div><div id="sgsText" class="shloka-text hidden">Loading...</div></div>
            <div><div id="sringeriLabel" class="textbox-label active">Sringeri Style Shloka</div><div id="sringeriText" class="shloka-text visible">Loading...</div></div>
         </div>

         <div class="player-container">
            <button onclick="sendCommand('PreviousShloka')">Previous</button>
            <button onclick="sendCommand('FullShloka')">Full</button>
            <button onclick="sendCommand('NextFullShloka')">Next</button>
         </div>

         <div class="credits">
            <p>Developed with love by <strong>Dr. P. Udayabhaskar</strong><br>
            Audio Source: SGS & Sringeri Mutt | Text: Traditional Sources</p>
         </div>
      </div>

      <script>
         // Your full original script here (sendCommand, fetch functions, etc.)
         // ... (keep everything exactly as it was – just remove the duplicate </script>)

         // ——— FINAL CONTINUOUS PLAY + NO FREEZE + WORKS ON LOCKED SCREEN ———
         let lastRandomIntent = null;
         let continuousPlayEnabled = false;
         let continuousDelay = 60000;

         const audioPlayer = document.getElementById('audioPlayer');
         const stopBtn = document.getElementById('stopContinuousBtn');

         function scheduleNext() {
            if (!continuousPlayEnabled) return;
            setTimeout(() => {
               if (continuousPlayEnabled && lastRandomIntent) {
                  sendCommand(lastRandomIntent);
               }
            }, continuousDelay);
         }

         if (!window.cpReady) {
            const orig = window.sendCommand;
            window.sendCommand = function(intent) {
               orig(intent);
               if (['SGSFirstPaada','SringeriPaada','ThirdPaada'].includes(intent)) {
                  const checked = document.querySelector('input[name="continuousGap"]:checked');
                  if (checked) {
                     lastRandomIntent = intent;
                     continuousPlayEnabled = true;
                     continuousDelay = checked.value == '30' ? 30000 : 60000;
                     stopBtn.style.display = 'inline-block';
                     audioPlayer.onended = scheduleNext;
                  }
               }
            };
            window.cpReady = true;
         }

         document.querySelectorAll('input[name="continuousGap"]').forEach(r => {
            r.addEventListener('change', () => {
               const checked = document.querySelector('input[name="continuousGap"]:checked');
               if (checked) {
                  continuousDelay = checked.value == '30' ? 30000 : 60000;
                  stopBtn.style.display = 'inline-block';
                  if (lastRandomIntent) audioPlayer.onended = scheduleNext;
               } else {
                  continuousPlayEnabled = false;
                  stopBtn.style.display = 'none';
                  audioPlayer.onended = null;
                  lastRandomIntent = null;
               }
            });
         });

         stopBtn.onclick = () => {
            document.querySelectorAll('input[name="continuousGap"]').forEach(r => r.checked = false);
            continuousPlayEnabled = false;
            stopBtn.style.display = 'none';
            audioPlayer.onended = null;
            lastRandomIntent = null;
         };

         // ——— NO FREEZE + WORKS WHEN SCREEN OFF (Final Safe Version) ———
         let noSleepEnabled = false;
         const silent = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=');
         silent.loop = true;
         silent.volume = 0;

         function enableNoSleep() {
            if (noSleepEnabled) return;
            noSleepEnabled = true;
            silent.play().catch(() => {});
            const video = document.createElement('video');
            video.src = 'data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAG1wNDJtcDQxaXMzAAACbGF2ZjU4LjI5LjEwMAA=';
            video.loop = video.muted = true;
            video.style.position = 'absolute';
            video.style.left = '-9999px';
            document.body.appendChild(video);
            video.play().catch(() => {});
         }

         document.body.addEventListener('click', enableNoSleep, {once: true});
         audioPlayer.addEventListener('play', enableNoSleep);

         // Theme
         const setTheme = t => {
            document.documentElement.setAttribute('data-theme', t);
            document.querySelectorAll('.theme-toggle button').forEach(b => b.classList.toggle('active', b.dataset.theme === t));
            localStorage.setItem('theme', t);
         };
         setTheme(localStorage.getItem('theme') || 'light');
         document.querySelectorAll('.theme-toggle button').forEach(b => b.onclick = () => setTheme(b.dataset.theme));
      </script>
   </body>
</html>
