<!DOCTYPE html>
<html>
<head>
    <title>Bhagavad Gita Bot</title>
</head>
<body>
    <button onclick="sendCommand('ZeroIntent')">Browse Random Shloka</button>
    <button onclick="sendCommandWithValue('ChapterIntent', document.getElementById('chapter-select').value)">Play Chapter</button>
    <button onclick="sendCommand('NextIntent')">Play Next Shloka</button>
    <button onclick="sendCommand('FullIntent')">Play Entire Shloka</button>
    <select id="chapter-select">
        <option value="1">Chapter 1</option>
        <!-- Add other chapters -->
    </select>
    <div id="shloka-text"></div>
    <script>
        let shlokas = [];
        fetch('BG_Sringeri.txt')
            .then(response => response.text())
            .then(text => {
                shlokas = text.split('\n').map(line => {
                    const match = line.match(/^(\d+)\.(\d+)\s+(.+)/);
                    if (match) {
                        return {
                            chapter: parseInt(match[1]),
                            verse: parseInt(match[2]),
                            text: match[3]
                        };
                    }
                    return null;
                }).filter(s => s);
                console.log('Loaded shlokas:', shlokas.length, shlokas.slice(0, 5));
            })
            .catch(error => console.log('Error loading BG_Sringeri.txt:', error));

        async function sendCommand(command) {
            try {
                const response = await fetch('http://localhost:8080/webhook', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ queryResult: { intent: { displayName: command } } })
                });
                const data = await response.json();
                console.log('Webhook response:', data);
                const params = data.outputContexts?.[0]?.parameters;
                if (params?.chapter && params?.verse) {
                    const chapter = parseInt(params.chapter);
                    const verse = parseInt(params.verse);
                    console.log(`Searching for shloka: chapter = ${chapter}, verse = ${verse}`);
                    const shloka = shlokas.find(s => s.chapter === chapter && s.verse === verse);
                    if (shloka) {
                        console.log('Found shloka:', shloka);
                        document.getElementById('shloka-text').textContent = shloka.text;
                    } else {
                        console.log('No shloka text found for:', chapter, verse);
                        document.getElementById('shloka-text').textContent = 'No shloka text found';
                    }
                } else {
                    console.log('Error: Missing parameters in webhook response');
                    document.getElementById('shloka-text').textContent = 'Error: Missing parameters';
                }
            } catch (error) {
                console.log('Error processing command:', error);
                document.getElementById('shloka-text').textContent = 'Error processing command';
            }
        }

        async function sendCommandWithValue(command, value) {
            try {
                const response = await fetch('http://localhost:8080/webhook', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        queryResult: {
                            intent: { displayName: command },
                            parameters: { chapter: parseInt(value) }
                        }
                    })
                });
                const data = await response.json();
                console.log('Webhook response:', data);
                const params = data.outputContexts?.[0]?.parameters;
                if (params?.chapter && params?.verse) {
                    const chapter = parseInt(params.chapter);
                    const verse = parseInt(params.verse);
                    console.log(`Searching for shloka: chapter = ${chapter}, verse = ${verse}`);
                    const shloka = shlokas.find(s => s.chapter === chapter && s.verse === verse);
                    if (shloka) {
                        console.log('Found shloka:', shloka);
                        document.getElementById('shloka-text').textContent = shloka.text;
                    } else {
                        console.log('No shloka text found for:', chapter, verse);
                        document.getElementById('shloka-text').textContent = 'No shloka text found';
                    }
                } else {
                    console.log('Error: Missing parameters in webhook response');
                    document.getElementById('shloka-text').textContent = 'Error: Missing parameters';
                }
            } catch (error) {
                console.log('Error processing command:', error);
                document.getElementById('shloka-text').textContent = 'Error processing command';
            }
        }
    </script>
</body>
</html>
