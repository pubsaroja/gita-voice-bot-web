<!DOCTYPE html>
<html>
<head>
    <title>Srimad Bhagavad Gita</title>
</head>
<body>
    <h1>Srimad Bhagavad Gita</h1>
    <p>Listen, understand and memorize Bhagavad Gita shlokas</p>

    <div>
        <label><input type="radio" name="style" value="SGS"> SGS (1st Paada)</label>
        <label><input type="radio" name="style" value="Sringeri"> Sringeri (1st or 3rd Paada)</label>
    </div>

    <div>
        <h3>Style:</h3>
        <button>SGS</button>
        <button>Sringeri</button>
    </div>

    <div>
        <button>Previous</button>
        <button>Full</button>
        <button>Next</button>
    </div>

    <div>
        <h3>SGS Style Shloka</h3>
        <p id="sgsShloka">Your Shloka will appear here.</p>
    </div>

    <div>
        <h3>Sringeri Style Shloka</h3>
        <p id="sringeriShloka">Your Shloka will appear here.</p>
    </div>

    <div>
        <button>Meanings</button>
        <button>Selector</button>
        <button>Instructions</button>
    </div>

    <div>
        <h3>Random Shloka Chapterwise:</h3>
        <select id="randomChapter">
            <option>Select Chapter</option>
            <option>1. అర్జునవిషాదయోగః</option>
            <option>2. సాఙ్ఖ్యయోగః</option>
            <option>3. కర్మయోగః</option>
            <option>4. జ్ఞానయోగః</option>
            <option>5. కర్మసన్న్యాసయోగః</option>
            <option>6. ఆత్మసంయమయోగః</option>
            <option>7. జ్ఞానవిజ్ఞానయోగః</option>
            <option>8. అక్షరపరబ్రహ్మయోగః</option>
            <option>9. రాజవిద్యారాజగుహ్యయోగః</option>
            <option>10. విభూతియోగః</option>
            <option>11. విశ్వరూపసన్దర్శనయోగః</option>
            <option>12. భక్తియోగః</option>
            <option>13. క్షేత్రక్షేత్రజ్ఞవిభాగయోగః</option>
            <option>14. గుణత్రయవిభాగయోగః</option>
            <option>15. పురుషోత్తమప్రాప్తియోగః</option>
            <option>16. దైవాసురసమ్పద్విభాగయోగః</option>
            <option>17. శ్రద్ధాత్రయవిభాగయోగః</option>
            <option>18. మోక్షసన్న్యాసయోగః</option>
        </select>
    </div>

    <div>
        <h3>Continuous Play:</h3>
        <select id="continuousChapter">
            <option>Select Chapter</option>
            <option>1. అర్జునవిషాదయోగః</option>
            <option>2. సాఙ్ఖ్యయోగః</option>
            <option>3. కర్మయోగః</option>
            <option>4. జ్ఞానయోగః</option>
            <option>5. కర్మసన్న్యాసయోగః</option>
            <option>6. ఆత్మసంయమయోగః</option>
            <option>7. జ్ఞానవిజ్ఞానయోగః</option>
            <option>8. అక్షరపరబ్రహ్మయోగః</option>
            <option>9. రాజవిద్యారాజగుహ్యయోగః</option>
            <option>10. విభూతియోగః</option>
            <option>11. విశ్వరూపసన్దర్శనయోగః</option>
            <option>12. భక్తియోగః</option>
            <option>13. క్షేత్రక్షేత్రజ్ఞవిభాగయోగః</option>
            <option>14. గుణత్రయవిభాగయోగః</option>
            <option>15. పురుషోత్తమప్రాప్తియోగః</option>
            <option>16. దైవాసురసమ్పద్విభాగయోగః</option>
            <option>17. శ్రద్ధాత్రయవిభాగయోగః</option>
            <option>18. మోక్షసన్న్యాసయోగః</option>
        </select>
    </div>

    <div>
        <h3>Search for word (Telugu or English):</h3>
        <input type="text" id="searchInput" placeholder="Enter word to search">
        <button id="searchBtn">Search</button>
    </div>

    <div>
        <p><strong>SGS Audio:</strong> Pujya Sri Datta Vijayanand Teertha Swamiji</p>
        <p><strong>Sringeri Audio courtesy:</strong> Smt Mathangi Kailasnath</p>
        <p><strong>Developed by</strong> Dr. P. Udayabhaskar</p>
    </div>

    <div>
        <button>Close</button>
        <select id="chapterSelect">
            <option>-- Select Chapter --</option>
            <option>Chapter 1 (47 verses)</option>
            <option>Chapter 2 (72 verses)</option>
            <option>Chapter 3 (43 verses)</option>
            <option>Chapter 4 (42 verses)</option>
            <option>Chapter 5 (29 verses)</option>
            <option>Chapter 6 (47 verses)</option>
            <option>Chapter 7 (30 verses)</option>
            <option>Chapter 8 (28 verses)</option>
            <option>Chapter 9 (34 verses)</option>
            <option>Chapter 10 (42 verses)</option>
            <option>Chapter 11 (55 verses)</option>
            <option>Chapter 12 (20 verses)</option>
            <option>Chapter 13 (34 verses)</option>
            <option>Chapter 14 (27 verses)</option>
            <option>Chapter 15 (20 verses)</option>
            <option>Chapter 16 (24 verses)</option>
            <option>Chapter 17 (28 verses)</option>
            <option>Chapter 18 (78 verses)</option>
        </select>
    </div>

    <script src="https://unpkg.com/@indic-transliteration/sanscript@1.2.11/dist/browser/sanscript.js"></script>
    <script>
        // Map to store shlokas
        var sringeriShlokas = new Map();
        var englishShlokas = new Map();

        // Load text files
        async function loadFiles() {
            try {
                const sringeriResponse = await fetch('Sringeri.txt');
                if (!sringeriResponse.ok) throw new Error('Failed to load Sringeri.txt');
                const sringeriText = await sringeriResponse.text();
                console.log('Sringeri.txt loaded successfully');
                sringeriText.split('\n').forEach(line => {
                    line = line.trim();
                    if (line) {
                        const [key, ...textParts] = line.split(' ');
                        sringeriShlokas.set(key, textParts.join(' '));
                    }
                });

                const englishResponse = await fetch('BG English with Uvacha.txt');
                if (!englishResponse.ok) throw new Error('Failed to load BG English with Uvacha.txt');
                const englishText = await englishResponse.text();
                console.log('BG English with Uvacha.txt loaded successfully');
                englishText.split('\n').forEach(line => {
                    line = line.trim();
                    if (line) {
                        const [key, ...textParts] = line.split(' ');
                        englishShlokas.set(key, textParts.join(' '));
                    }
                });
            } catch (error) {
                console.error('Error loading files:', error);
                document.getElementById('sgsShloka').innerHTML = 'Error loading text files.';
                document.getElementById('sringeriShloka').innerHTML = 'Error loading text files.';
            }
        }

        // Search function
        function searchShloka() {
            const input = document.getElementById('searchInput').value.trim();
            console.log('Search input:', input);
            if (!input) {
                console.log('No input provided');
                document.getElementById('sgsShloka').innerHTML = 'Please enter a search term.';
                document.getElementById('sringeriShloka').innerHTML = 'Please enter a search term.';
                return;
            }

            const isTelugu = /[\u0C00-\u0C7F]/.test(input);
            console.log('Is Telugu:', isTelugu);
            let results = [];

            if (isTelugu) {
                console.log('Searching in Sringeri.txt');
                for (let [key, text] of sringeriShlokas) {
                    if (text.includes(input)) {
                        const escapedInput = input.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        const highlighted = text.replace(new RegExp(escapedInput, 'gi'), '<span style="background-color: yellow;">$&</span>');
                        results.push(`${key} ${highlighted}`);
                    }
                }
            } else {
                console.log('Searching in BG English with Uvacha.txt');
                const teluguWord = Sanscript.t(input.toLowerCase(), 'itrans', 'telugu');
                console.log('Transliterated to Telugu:', teluguWord);
                for (let [key, text] of englishShlokas) {
                    if (text.toLowerCase().includes(input.toLowerCase())) {
                        let sringeriText = sringeriShlokas.get(key);
                        if (sringeriText) {
                            const escapedTelugu = teluguWord.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                            const highlighted = sringeriText.replace(new RegExp(escapedTelugu, 'gi'), '<span style="background-color: yellow;">$&</span>');
                            results.push(`${key} ${highlighted}`);
                        }
                    }
                }
            }

            const displayText = results.join('<br><br>');
            console.log('Search results:', results);
            document.getElementById('sgsShloka').innerHTML = displayText || 'No results found.';
            document.getElementById('sringeriShloka').innerHTML = displayText || 'No results found.';
        }

        // Initialize on page load
        window.onload = async function() {
            await loadFiles();
            document.getElementById('searchBtn').addEventListener('click', searchShloka);
        };
    </script>
</body>
</html>
