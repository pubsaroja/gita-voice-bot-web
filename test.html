<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Bhagavad Gita Bot</title>
      <meta name="description" content="Explore Bhagavad Gita shlokas in Telugu with SGS and Sringeri styles, featuring audio recitations and meanings.">
      <meta name="keywords" content="Bhagavad Gita, SGS, Sringeri, Telugu shlokas, audio recitation, spiritual app">
      <meta name="author" content="Dr. P. Udayabhaskar">
      <meta name="robots" content="index, follow">
      <link rel="canonical" href="https://pubsaroja.github.io/bhagavad-gita-bot/">

      <style type="text/css">
         @font-face {font-family:Ramabhadra;font-style:normal;font-weight:400;src:url(/cf-fonts/s/ramabhadra/5.0.11/latin/400/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}
         @font-face {font-family:Ramabhadra;font-style:normal;font-weight:400;src:url(/cf-fonts/s/ramabhadra/5.0.11/latin-ext/400/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;}
         @font-face {font-family:Ramabhadra;font-style:normal;font-weight:400;src:url(/cf-fonts/s/ramabhadra/5.0.11/telugu/400/normal.woff2);unicode-range:U+0951-0952,U+0964-0965,U+0C00-0C7F,U+1CDA,U+200C-200D,U+25CC;}

         body {font-family:Ramabhadra,Georgia,serif;background:#fef9e7;color:#5d2f00;margin:0;padding:20px;}
         h1,h2{color:#b8860b;text-align:center;margin:10px 0;}
         .container{max-width:900px;margin:auto;background:#fffef0;padding:25px;border-radius:18px;box-shadow:0 8px 25px rgba(0,0,0,0.1);}
         .controls{text-align:center;margin:25px 0;}
         .buttons{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px;margin:30px 0;}
         button{padding:20px;font-size:20px;background:#ffeb3b;border:3px solid #f57f17;border-radius:15px;cursor:pointer;transition:0.3s;box-shadow:0 4px 10px rgba(0,0,0,0.1);}
         button:hover{background:#ffb300;transform:translateY(-4px);}
         #output{margin:30px 0;padding:25px;background:white;border-left:8px solid #ff9800;font-size:21px;line-height:2;min-height:150px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
         #audioPlayer{width:100%;margin:25px 0;}
         select{padding:12px 15px;font-size:18px;border-radius:10px;border:2px solid #ff9800;}
         .checkbox-label{font-size:20px;font-weight:bold;color:#d84315;margin:0 10px;}
         input[type=checkbox]{transform:scale(1.8);margin-right:12px;vertical-align:middle;}
      </style>
   </head>
   <body>
      <div class="container">
         <h1>ॐ नमो भगवते वासुदेवाय</h1>
         <h2>Bhagavad Gita Voice Bot</h2>

         <div class="controls">
            <label class="checkbox-label">
               <input type="checkbox" id="continuousRandomPlay">
               Continuous Random Play (60 sec gap)
            </label>
            <br><br>
            <label style="font-size:19px;">
               Chanting Style: 
               <select id="styleSelect">
                  <option value="sgs">SGS (Standard)</option>
                  <option value="sringeri">Sringeri Sharada Peetham</option>
               </select>
            </label>
         </div>

         <div class="buttons">
            <button onclick="sendCommand('SGSFirstPaada')">First Pāda Only (SGS)</button>
            <button onclick="sendCommand('SringeriPaada')">1st or 3rd Pāda (Sringeri)</button>
            <button onclick="sendCommand('ThirdPaada')">Third Pāda Only</button>
            <button onclick="sendCommand('FullShloka')">Full Shloka (Auto Style)</button>
         </div>

         <div id="output">Tap any button above to receive a divine shloka...</div>
         <audio id="audioPlayer" controls preload="none"></audio>
      </div>

      <script>
         const baseUrl = "https://pubsaroja.github.io/gita-voice-bot-web";
         const audioPlayer = document.getElementById('audioPlayer');
         const outputDiv = document.getElementById('output');
         let lastRandomIntent = null;

         function getSelectedStyle() {
            return document.getElementById('styleSelect').value;
         }

         async function fetchCombinedShlokaText(chapter, verse) {
            const langs = ['Telugu','English','Sanskrit'];
            let result = `<strong>अध्याय ${chapter} | श्लोक ${verse}</strong><br><br>`;
            for (const lang of langs) {
               try {
                  const resp = await fetch(`${baseUrl}/texts/${lang}/Chapter ${chapter}/${verse}.txt?t=${Date.now()}`);
                  if (resp.ok) {
                     const txt = await resp.text();
                     result += `<strong>${lang}:</strong><br>${txt.trim().replace(/\n/g,'<br>')}<br><br>`;
                  }
               } catch(e) { console.warn(`Text load failed: ${lang}`, e); }
            }
            return result;
         }

         async function fetchAudioUrl(chapter, verse, quarter = null, isFull = false) {
            try {
               const style = getSelectedStyle();
               let url = '';

               if (isFull) {
                  const folder = style === 'sringeri' ? 'AudioFullSringeri' : 'AudioFullSGS';
                  url = `${baseUrl}/${folder}/${chapter}.${verse}.mp3`;
               } else if (quarter === 'pada1') {
                  url = `${baseUrl}/AQ4PaadasSGS/Chapter ${chapter}/${verse}.1.mp3`;
               } else if (quarter === 'pada3') {
                  const folder = style === 'sringeri' ? 'AQ4PaadasSringeri' : 'AQ4PaadasSGS';
                  url = `${baseUrl}/${folder}/Chapter ${chapter}/${verse}.3.mp3`;
               } else if (quarter === 'pada1_or_pada3') {
                  const folder = style === 'sringeri' ? 'AQ4PaadasSringeri' : 'AQ4PaadasSGS';
                  const pada = Math.random() < 0.5 ? '1' : '3';
                  url = `${baseUrl}/${folder}/Chapter ${chapter}/${verse}.${pada}.mp3`;
               }

               const response = await fetch(url, { method: 'GET', cache: 'no-cache' });
               if (!response.ok) throw new Error(`HTTP ${response.status}`);
               const len = response.headers.get('content-length');
               if (len && parseInt(len) === 0) throw new Error('Empty file');
               return url;
            } catch (err) {
               console.error('Audio fetch failed:', err);
               return { error: 'Audio not available' };
            }
         }

         async function sendCommand(intent) {
            outputDiv.innerHTML = 'ॐ Receiving divine message...';
            audioPlayer.src = '';
            audioPlayer.pause();

            const chapter = Math.floor(Math.random() * 18) + 1;
            const maxVerses = [0,47,72,43,42,29,47,30,28,34,42,55,20,35,27,20,24,28,78];
            const verse = Math.floor(Math.random() * maxVerses[chapter]) + 1;

            let quarter = null;
            let isFull = false;

            if (intent === 'SGSFirstPaada') quarter = 'pada1';
            else if (intent === 'SringeriPaada') quarter = 'pada1_or_pada3';
            else if (intent === 'ThirdPaada') quarter = 'pada3';
            else if (intent === 'FullShloka') isFull = true;

            const audioUrl = await fetchAudioUrl(chapter, verse, quarter, isFull);
            const text = await fetchCombinedShlokaText(chapter, verse);
            outputDiv.innerHTML = text;

            if (audioUrl && !audioUrl.error) {
               audioPlayer.src = audioUrl;
               audioPlayer.play().catch(e => console.error('Play error:', e));
            } else {
               outputDiv.innerHTML += `<br><span style="color:red;">Audio temporarily unavailable</span>`;
            }

            // === Continuous Random Play ===
            audioPlayer.onended = null;
            if (['SGSFirstPaada','SringeriPaada','ThirdPaada','FullShloka'].includes(intent)) {
               const cb = document.getElementById('continuousRandomPlay');
               if (cb && cb.checked && audioUrl && !audioUrl.error) {
                  lastRandomIntent = intent;
                  audioPlayer.onended = async () => {
                     await new Promise(r => setTimeout(r, 60000)); // 60 sec gap
                     if (document.getElementById('continuousRandomPlay').checked && lastRandomIntent) {
                        sendCommand(lastRandomIntent);
                     }
                  };
               } else {
                  lastRandomIntent = null;
               }
            }
         }

         // Stop continuous play when unchecked
         document.getElementById('continuousRandomPlay').addEventListener('change', function() {
            if (!this.checked) {
               audioPlayer.onended = null;
               lastRandomIntent = null;
            }
         });
      </script>
   </body>
</html>
