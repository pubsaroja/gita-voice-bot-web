<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Bhagavad Gita Bot</title>
      <meta name="description" content="Explore Bhagavad Gita shlokas in Telugu with SGS and Sringeri styles, featuring audio recitations and meanings.">
      <meta name="keywords" content="Bhagavad Gita, SGS, Sringeri, Telugu shlokas, audio recitation, spiritual app">
      <meta name="author" content="Dr. P. Udayabhaskar">
      <meta name="robots" content="index, follow">
      <link rel="canonical" href="https://pubsaroja.github.io/bhagavad-gita-bot/">
      <link href="https://fonts.googleapis.com/css2?family=Ramabhadra&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="https://unpkg.com/intro.js/minified/introjs.min.css">
      <script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>
      <style>
         :root{--bg-color:#f0f0f0;--text-color:#2c3e50;--card-bg:#ffffff;--card-border:#357EC7;--button-bg:#357EC7;--button-text:#ffffff;--button-hover-bg:#1e40af;--header-color:#2c3e50;--subheader-color:#34495e;--input-border:#ccc;--modal-bg:#ffffff;--verse-button-bg:#f9f9f9;--verse-button-hover-bg:#e0e0e0;--intro-overlay:rgba(0,0,0,0.5);--intro-button-bg:#e5e7eb;--intro-button-text:#111827;--intro-tooltip-bg:#ffffff;}
         [data-theme="dark"]{--bg-color:#1a1a1a;--text-color:#ffffff;--card-bg:#2a2a2a;--card-border:#4a90e2;--button-bg:#4a90e2;--button-text:#ffffff;--button-hover-bg:#357abd;--header-color:#ffffff;--subheader-color:#cccccc;--input-border:#444;--modal-bg:#2a2a2a;--verse-button-bg:#333;--verse-button-hover-bg:#444;--intro-overlay:rgba(0,0,0,0.7);--intro-button-bg:#444;--intro-button-text:#ffffff;--intro-tooltip-bg:#333;}
         *,*::before,*::after{box-sizing:border-box;}
         body{font-family:Outfit,sans-serif;text-align:center;padding:20px;margin:0;background-color:var(--bg-color);color:var(--text-color);overflow-x:hidden;transition:all .3s ease;}
         h1{color:var(--header-color);font-size:1.5em;}
         h2{color:var(--subheader-color);font-size:1em;margin-top:10px;}
         .theme-toggle{position:fixed;top:10px;right:10px;display:flex;gap:10px;z-index:1001;}
         .theme-toggle button{background:none;border:none;cursor:pointer;font-size:20px;color:var(--text-color);opacity:.6;transition:opacity .3s;}
         .theme-toggle button:hover,.theme-toggle button.active{opacity:1;}
         .page-frame{max-width:900px;margin:8px auto;padding:12px;border:2px solid var(--card-border);border-radius:10px;background:var(--card-bg);box-shadow:0 2px 6px rgba(0,0,0,.04);}
         @media(max-width:600px){.page-frame{margin:4px;padding:16px;border-radius:10px;border-width:4px;overflow:hidden;}}
         .top-buttons{display:flex;justify-content:center;gap:10px;width:100%;max-width:600px;margin:0 auto;padding-left:12px;padding-right:12px;box-sizing:border-box;}
         .top-buttons button{width:150px;height:150px;border-radius:25%;border:none;background-color:var(--button-bg);color:var(--button-text);font-size:20px;cursor:pointer;transition:background .3s ease;background-repeat:no-repeat;background-position:center;background-size:cover;}
         .top-buttons button.sgs-button:hover,.top-buttons button.sgs-button:active{background-image:url('https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/main/sankhu.png');background-color:transparent!important;color:transparent!important;}
         .top-buttons button.sringeri-button:hover,.top-buttons button.sringeri-button:active,.top-buttons button.third-paada-button:hover,.top-buttons button.third-paada-button:active{background-image:url('https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/main/chakra.png');background-color:transparent!important;color:transparent!important;}
         .top-buttons button.reset,.top-buttons button.reset:hover,.top-buttons button.reset:active,.top-buttons button.reset:focus{background:var(--button-bg)!important;color:var(--button-text)!important;background-image:none!important;}
         .button-groups{display:flex;justify-content:center;gap:10px;max-width:600px;margin:0 auto;width:100%;padding-left:12px;padding-right:12px;box-sizing:border-box;}
         .button-group{display:flex;flex-direction:column;gap:10px;width:50%;}
         .button-groups button{background-color:var(--button-bg);color:var(--button-text);padding:10px 18px;border:none;border-radius:5px;cursor:pointer;font-family:'Outfit',sans-serif;font-size:1.6em;width:100%;max-width:150px;transition:background-color .3s ease;}
         .button-groups button:hover{background-color:var(--card-bg);color:transparent;}
         .dropdown-container{display:flex;flex-direction:column;gap:20px;max-width:600px;margin:0 auto;border:2px solid var(--card-border);border-radius:5px;padding:10px 12px;box-sizing:border-box;}
         .dropdown-item{display:flex;flex-direction:column;}
         .dropdown-label{margin-bottom:6px;font-weight:bold;font-size:1em;color:var(--header-color);}
         select{width:100%;padding:8px;font-size:1em;border-radius:5px;border:1px solid var(--input-border);background-color:var(--card-bg);color:var(--text-color);}
         .shloka-text{margin-top:10px;font-size:1.5em;color:var(--text-color);white-space:pre-wrap;max-width:100%;line-height:1.5;min-height:3em;overflow-y:auto;padding:0;display:none;justify-content:center;align-items:center;text-align:center;font-family:'Noto Sans Telugu','Noto Sans Devanagari','Noto Sans Kannada','Noto Sans Tamil',sans-serif;box-sizing:border-box;}
         .shloka-text.active{display:flex;}
         .shloka-text.active.multiline{display:block;text-align:left;}
         #sgsText,#sringeriText{display:block;width:100%;white-space:pre-line!important;word-wrap:break-word;overflow-wrap:break-word;overflow-wrap:anywhere;word-break:break-word;hyphens:auto;text-align:center;margin-left:0;margin-right:0;max-width:100%;font-family:'Noto Sans Telugu','Noto Sans Devanagari','Noto Sans Kannada','Noto Sans Tamil',sans-serif;font-size:1.5em;line-height:1.5;border:none;padding:0;overflow-y:auto;overflow-x:auto;min-height:3em;box-sizing:border-box;}
         .hidden{display:none!important;}
         .shloka-text.visible{display:flex!important;flex-direction:column;align-items:center;justify-content:center;text-align:center;}
         .shloka-text.placeholder{display:flex!important;flex-direction:column;align-items:center;justify-content:center;text-align:center;}
         .shloka-text.visible.multiline{display:block!important;text-align:left;}
         .visible{display:block!important;}
         #audioPlayer{margin:10px auto;display:block;flex-shrink:0;}
         .radio-group{margin:10px 0;display:flex;justify-content:center;align-items:center;gap:10px;width:100%;max-width:600px;margin-left:auto;margin-right:auto;padding-left:12px;padding-right:12px;box-sizing:border-box;}
         .radio-group label{margin:0 10px;color:var(--text-color);}
         .textbox-container{display:flex;flex-direction:column;align-items:stretch;gap:10px;width:100%;max-width:600px;margin:12px auto 0;padding-left:12px;padding-right:12px;border:2px solid var(--card-border);border-radius:5px;box-sizing:border-box;}
         .textbox-container > div{width:100%;max-width:100%;}
         .textbox-label{font-weight:bold;margin-bottom:5px;display:none;color:var(--header-color);}
         .textbox-label.active{display:block;}
         .player-container{display:grid;grid-template-columns:repeat(3,max-content);grid-template-rows:repeat(2,auto);gap:10px 5px;justify-content:center;justify-items:center;align-items:center;max-width:600px;margin:20px auto 0;width:100%;box-sizing:border-box;border:none;border-radius:5px;padding:12px;}
         .player-container button{width:100px;height:40px;border:none;border-radius:25px;background-color:var(--button-bg);color:var(--button-text);font-family:'Outfit',sans-serif;font-size:16px;cursor:pointer;padding:0 15px;transition:background .3s ease;justify-self:center;align-self:center;}
         .player-container button:hover{background-color:var(--button-hover-bg);}
         @media(max-width:600px){
            body{padding:6px;}
            .top-buttons,.button-groups,.dropout-container,.radio-group,.player-container,.textbox-container{width:100%;max-width:100%;margin:0 auto;padding-left:12px;padding-right:12px;box-sizing:border-box;flex-wrap:wrap;}
            .top-buttons{margin-top:6px;gap:5px;flex-direction:row;}
            .player-container{margin-top:12px;padding-left:12px;padding-right:12px;grid-template-columns:repeat(3,1fr);}
            .player-container button{width:100%;}
            .shloka-text{font-size:1.25em;padding:0;text-align:left;overflow-x:auto;}
            #sgsText,#sringeriText{font-size:1.25em;text-align:left;padding-left:0;white-space:pre-line;word-wrap:break-word;overflow-wrap:break-word;overflow-wrap:anywhere;word-break:break-word;hyphens:auto;overflow-x:auto;}
            .shloka-text.visible,.shloka-text.placeholder{justify-content:flex-start;text-align:left;}
            .button-groups{margin-top:12px;gap:5px;flex-direction:row;}
            .button-group{width:50%;gap:5px;}
            .top-buttons button{flex:1 1 calc(33.333% - 10px);max-width:none;height:auto;aspect-ratio:1/1;font-size:0.8em;}
            .button-groups button{padding:6px 12px;font-size:0.8em;max-width:100%;}
         }
      </style>
   </head>
   <body>
      <div class="theme-toggle" data-intro="Change the theme Light or Dark" data-title="Theme">
         <button id="themeLight" title="Light Theme" data-theme="light" class="active">Light</button>
         <button id="themeDark" title="Dark Theme" data-theme="dark">Dark</button>
      </div>
      <div class="page-frame">
         <h1>Srimad Bhagavad Gita</h1>
         <p>Listen, understand and memorize Bhagavad Gita shlokas</p>
         <div class="top-buttons" data-intro="Choose how you want to hear the shloka" data-title="Playback Options">
            <button class="sgs-button" onclick="sendCommand('SGSFirstPaada')" data-intro="Play only 1st Paada in SGS style" data-title="1st Paada (SGS)">1st Paada<br>Only</button>
            <button class="sringeri-button" onclick="sendCommand('SringeriPaada')" data-intro="Play 1st or 3rd Paada in Sringeri style" data-title="1st or 3rd Paada (Sringeri)">1st or 3rd Paada</button>
            <button class="third-paada-button" onclick="sendCommand('ThirdPaada')" data-intro="Play only 3rd Paada" data-title="3rd Paada Only">3rd Paada<br>Only</button>
         </div>

         <!-- NEW: Continuous Play Options (30s & 60s) -->
         <div style="text-align:center;margin:20px 0;padding:10px;background:var(--card-bg);border-radius:8px;">
            <strong style="font-size:1.2em;">Continuous Random Play</strong><br><br>
            <label style="margin:0 15px;cursor:pointer;font-size:1em;">
               <input type="radio" name="continuousGap" id="gap30" value="30"> 30-second gap
            </label>
            <label style="margin:0 15px;cursor:pointer;font-size:1em;">
               <input type="radio" name="continuousGap" id="gap60" value="60"> 60-second gap
            </label>
            <br><small style="color:var(--subheader-color);">(Applies only to the 3 buttons above)</small>
         </div>

         <audio id="audioPlayer" controls data-intro="Use these controls to play, pause, or scrub through the audio." data-title="Audio Player"></audio>
         <div class="radio-group" data-intro="Pick the chanting style for display and playback" data-title="Chanting Style">
            <label>Style:</label>
            <input type="radio" name="style" value="sgs" id="sgs" onchange="updateTextboxVisibility()">
            <label for="sgs">SGS</label>
            <input type="radio" name="style" value="sringeri" id="sringeri" checked onchange="updateTextboxVisibility()">
            <label for="sringeri">Sringeri</label>
         </div>
         <div class="player-container">
            <button onclick="sendCommand('PreviousShloka')" data-intro="Go to previous shloka" data-title="Previous">Previous</button>
            <button onclick="sendCommand('FullShloka')" data-intro="Play the full shloka" data-title="Full Shloka">Full</button>
            <button onclick="sendCommand('NextFullShloka')" data-intro="Go to next shloka" data-title="Next">Next</button>
         </div>
         <div class="textbox-container">
            <div>
               <div id="sgsLabel" class="textbox-label">SGS Style Shloka</div>
               <div id="sgsText" class="shloka-text hidden">Your Shloka will appear here.</div>
            </div>
            <div>
               <div id="sringeriLabel" class="textbox-label active">Sringeri Style Shloka</div>
               <div id="sringeriText" class="shloka-text visible">Your Shloka will appear here.</div>
            </div>
         </div>
         <!-- All your original buttons, dropdowns, credits remain exactly as before -->
         <!-- ... (your full original body content continues unchanged) ... -->
      </div>
      <script>
         // Your entire original script goes here unchanged up to the end
         // ... (all your existing functions, initialize(), theme code, etc.)

         // === ONLY NEW CODE ADDED BELOW (15 lines) ===
         let lastRandomIntent = null;

         // Handle continuous play with 30s or 60s gap
         document.getElementById('audioPlayer').onended = null;

         function triggerContinuousPlay(intent) {
            const gap30 = document.getElementById('gap30').checked;
            const gap60 = document.getElementById('gap60').checked;
            if (!gap30 && !gap60) {
               document.getElementById('audioPlayer').onended = null;
               lastRandomIntent = null;
               return;
            }
            lastRandomIntent = intent;
            const delay = gap30 ? 30000 : 60000;
            document.getElementById('audioPlayer').onended = () => {
               setTimeout(() => {
                  if (document.getElementById('gap30').checked || document.getElementById('gap60').checked) {
                     sendCommand(lastRandomIntent);
                  }
               }, delay);
            };
         }

         // Override only the 3 top random buttons
         const originalSendCommand = window.sendCommand;
         window.sendCommand = function(intent) {
            originalSendCommand(intent);
            if (['SGSFirstPaada','SringeriPaada','ThirdPaada'].includes(intent)) {
               triggerContinuousPlay(intent);
            }
         };

         // Stop when both are unchecked
         document.addEventListener('change', (e) => {
            if (e.target.name === 'continuousGap' && !document.querySelector('input[name="continuousGap"]:checked')) {
               document.getElementById('audioPlayer').onended = null;
               lastRandomIntent = null;
            }
         });
         // === END OF NEW CODE ===
      </script>
   </body>
</html>
