<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Bhagavad Gita Bot</title>
      <meta name="description" content="Explore Bhagavad Gita shlokas in Telugu with SGS and Sringeri styles, featuring audio recitations and meanings.">
      <meta name="keywords" content="Bhagavad Gita, SGS, Sringeri, Telugu shlokas, audio recitation, spiritual app">
      <meta name="author" content="Dr. P. Udayabhaskar">
      <meta name="robots" content="index, follow">
      <link rel="canonical" href="https://pubsaroja.github.io/bhagavad-gita-bot/">
      <style type="text/css">
         @font-face {font-family:Ramabhadra;font-style:normal;font-weight:400;src:url(/cf-fonts/s/ramabhadra/5.0.11/latin/400/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}
         @font-face {font-family:Ramabhadra;font-style:normal;font-weight:400;src:url(/cf-fonts/s/ramabhadra/5.0.11/telugu/400/normal.woff2);unicode-range:U+0951-0952,U+0964-0965,U+0C00-0C7F,U+1CDA,U+200C-200D,U+25CC;font-display:swap;}
      </style>
      <style type="text/css">
         @font-face {font-family:Outfit;font-style:normal;font-weight:300;src:url(/cf-fonts/v/outfit/5.0.11/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}
         @font-face {font-family:Outfit;font-style:normal;font-weight:300;src:url(/cf-fonts/v/outfit/5.0.11/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}
      </style>
      <style type="text/css">
         @font-face {font-family:Noto Sans Telugu;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans-telugu/5.0.12/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}
         @font-face {font-family:Noto Sans Telugu;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans-telugu/5.0.12/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}
         @font-face {font-family:Noto Sans Telugu;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans-telugu/5.0.12/telugu/wght/normal.woff2);unicode-range:U+0951-0952,U+0964-0965,U+0C00-0C7F,U+1CDA,U+200C-200D,U+25CC;font-display:swap;}
      </style>
      <style type="text/css">
         @font-face {font-family:Noto Sans Devanagari;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans-devanagari/5.0.11/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}
         @font-face {font-family:Noto Sans Devanagari;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans-devanagari/5.0.11/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}
         @font-face {font-family:Noto Sans Devanagari;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans-devanagari/5.0.11/devanagari/wght/normal.woff2);unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FF;font-display:swap;}
      </style>
      <style type="text/css">
         @font-face {font-family:Noto Sans Kannada;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans-kannada/5.0.12/kannada/wght/normal.woff2);unicode-range:U+0964-0965,U+0C80-0CF2,U+200C-200D,U+20B9,U+25CC;font-display:swap;}
         @font-face {font-family:Noto Sans Kannada;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans-kannada/5.0.12/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}
         @font-face {font-family:Noto Sans Kannada;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans-kannada/5.0.12/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}
      </style>
      <style type="text/css">
         @font-face {font-family:Noto Sans Tamil;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans-tamil/5.0.11/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}
         @font-face {font-family:Noto Sans Tamil;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans-tamil/5.0.11/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}
         @font-face {font-family:Noto Sans Tamil;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans-tamil/5.0.11/tamil/wght/normal.woff2);unicode-range:U+0964-0965,U+0B82-0BFA,U+200C-200D,U+20B9,U+25CC;font-display:swap;}
      </style>
      <link rel="stylesheet" href="https://unpkg.com/intro.js/minified/introjs.min.css">
      <script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>
      <style>
         :root{--bg-color:#f0f0f0;--text-color:#2c3e50;--card-bg:#ffffff;--card-border:#357EC7;--button-bg:#357EC7;--button-text:#ffffff;--button-hover-bg:#1e40af;--header-color:#2c3e50;--subheader-color:#34495e;--input-border:#ccc;--modal-bg:#ffffff;--verse-button-bg:#f9f9f9;--verse-button-hover-bg:#e0e0e0;--intro-overlay:rgba(0,0,0,0.5);--intro-button-bg:#e5e7eb;--intro-button-text:#111827;--intro-tooltip-bg:#ffffff;}
         [data-theme="dark"]{--bg-color:#1a1a1a;--text-color:#ffffff;--card-bg:#2a2a2a;--card-border:#4a90e2;--button-bg:#4a90e2;--button-text:#ffffff;--button-hover-bg:#357abd;--header-color:#ffffff;--subheader-color:#cccccc;--input-border:#444;--modal-bg:#2a2a2a;--verse-button-bg:#333;--verse-button-hover-bg:#444;--intro-overlay:rgba(0,0,0,0.7);--intro-button-bg:#444;--intro-button-text:#ffffff;--intro-tooltip-bg:#333;}
         *,*::before,*::after{box-sizing:border-box;}
         body{font-family:Outfit,sans-serif;text-align:center;padding:20px;margin:0;background-color:var(--bg-color);color:var(--text-color);overflow-x:hidden;transition:all .3s ease;}
         h1{color:var(--header-color);font-size:1.5em;}
         h2{color:var(--subheader-color);font-size:1em;margin-top:10px;}
         .theme-toggle{position:fixed;top:10px;right:10px;display:flex;gap:10px;z-index:1001;}
         .theme-toggle button{background:none;border:none;cursor:pointer;font-size:20px;color:var(--text-color);opacity:.6;transition:opacity .3s;}
         .theme-toggle button:hover,.theme-toggle button.active{opacity:1;}
         .page-frame{max-width:900px;margin:8px auto;padding:12px;border:2px solid var(--card-border);border-radius:10px;background:var(--card-bg);box-shadow:0 2px 6px rgba(0,0,0,.04);}
         .top-buttons{display:flex;justify-content:center;gap:10px;max-width:600px;margin:0 auto;padding:0 12px;}
         .top-buttons button{width:150px;height:150px;border-radius:25%;border:none;background-color:var(--button-bg);color:var(--button-text);font-size:20px;cursor:pointer;transition:background .3s ease;background-repeat:no-repeat;background-position:center;background-size:cover;}
         .top-buttons button.sgs-button:hover,.top-buttons button.sgs-button:active{background-image:url('https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/main/sankhu.png');background-color:transparent!important;color:transparent!important;}
         .top-buttons button.sringeri-button:hover,.top-buttons button.sringeri-button:active,.top-buttons button.third-paada-button:hover,.top-buttons button.third-paada-button:active{background-image:url('https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/main/chakra.png');background-color:transparent!important;color:transparent!important;}
         #audioPlayer{margin:10px auto;display:block;}
         .radio-group{display:flex;justify-content:center;gap:10px;margin:10px 0;max-width:600px;margin-left:auto;margin-right:auto;padding:0 12px;}
         .textbox-container{display:flex;flex-direction:column;gap:10px;max-width:600px;margin:12px auto 0;padding:0 12px;border:2px solid var(--card-border);border-radius:5px;}
         .textbox-label{font-weight:bold;margin-bottom:5px;display:none;color:var(--header-color);}
         .textbox-label.active{display:block;}
         .player-container{display:grid;grid-template-columns:repeat(3,max-content);gap:10px 5px;justify-content:center;max-width:600px;margin:20px auto 0;padding:12px;}
         .player-container button{width:100px;height:40px;border:none;border-radius:25px;background-color:var(--button-bg);color:var(--button-text);font-size:16px;cursor:pointer;padding:0 15px;transition:background .3s ease;}
         .player-container button:hover{background-color:var(--button-hover-bg);}
         .shloka-text{font-size:1.5em;color:var(--text-color);line-height:1.5;min-height:3em;overflow-y:auto;display:none;justify-content:center;align-items:center;text-align:center;font-family:'Noto Sans Telugu','Noto Sans Devanagari','Noto Sans Kannada','Noto Sans Tamil',sans-serif;}
         .shloka-text.visible{display:flex;flex-direction:column;align-items:center;justify-content:center;}
         .shloka-text.visible.multiline{display:block;text-align:left;}
         #sgsText,#sringeriText{white-space:pre-line!important;word-wrap:break-word;overflow-wrap:anywhere;text-align:center;font-size:1.5em;line-height:1.5;overflow-y:auto;overflow-x:auto;min-height:3em;}
         @media(max-width:600px){.top-buttons{gap:5px;flex-direction:row;}
         .top-buttons button{flex:1 1 calc(33.333%-10px);height:auto;aspect-ratio:1/1;font-size:0.8em;}
         .shloka-text,#sgsText,#sringeriText{font-size:1.25em;}}
      </style>
   </head>
   <body>
      <div class="theme-toggle">
         <button id="themeLight" class="active">‚òÄÔ∏è</button>
         <button id="themeDark">üåô</button>
      </div>
      <div class="page-frame">
         <h1>Srimad Bhagavad Gita</h1>
         <p>Listen, understand and memorize Bhagavad Gita shlokas</p>
         <div class="top-buttons">
            <button class="sgs-button" onclick="sendCommand('SGSFirstPaada')">1st Paada<br>Only</button>
            <button class="sringeri-button" onclick="sendCommand('SringeriPaada')">1st or 3rd Paada</button>
            <button class="third-paada-button" onclick="sendCommand('ThirdPaada')">3rd Paada<br>Only</button>
         </div>

         <!-- NEW: Continuous Random Play Checkbox -->
         <div style="text-align:center;margin:20px 0;">
            <label style="font-size:1.2em;cursor:pointer;">
               <input type="checkbox" id="continuousRandomPlayCheckbox">
               <strong>Continuous Random Play (60 sec gap)</strong>
            </label>
         </div>

         <audio id="audioPlayer" controls></audio>

         <!-- Rest of your original HTML (100% unchanged) -->
         <div class="radio-group">
            <label>Style:</label>
            <input type="radio" name="style" value="sgs" id="sgs" onchange="updateTextboxVisibility()">
            <label for="sgs">SGS</label>
            <input type="radio" name="style" value="sringeri" id="sringeri" checked onchange="updateTextboxVisibility()">
            <label for="sringeri">Sringeri</label>
         </div>
         <div class="player-container">
            <button onclick="sendCommand('PreviousShloka')">Previous</button>
            <button onclick="sendCommand('FullShloka')">Full</button>
            <button onclick="sendCommand('NextFullShloka')">Next</button>
         </div>
         <div class="radio-group language-group">
            <label>Languages:</label>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:8px;">
               <label><input type="checkbox" name="language" value="te" id="telugu" checked> Telugu</label>
               <label><input type="checkbox" name="language" value="sa" id="devanagari"> Devanagari</label>
               <label><input type="checkbox" name="language" value="en" id="english"> English</label>
               <label><input type="checkbox" name="language" value="kn" id="kannada"> Kannada</label>
               <label><input type="checkbox" name="language" value="ta" id="tamil"> Tamil</label>
            </div>
         </div>
         <div class="textbox-container">
            <div><div id="sgsLabel" class="textbox-label">SGS Style Shloka</div><div id="sgsText" class="shloka-text hidden">Your Shloka will appear here.</div></div>
            <div><div id="sringeriLabel" class="textbox-label active">Sringeri Style Shloka</div><div id="sringeriText" class="shloka-text visible">Your Shloka will appear here.</div></div>
         </div>
         <div class="player-container">
            <button id="meaningsButton" onclick="handleMeanings()">Meanings</button>
            <button onclick="showVerseTable()">Selector</button>
            <button id="instructionsButton" onclick="toggleInstructions()">Help</button>
            <button id="groupButton" onclick="window.open('https://pubsaroja.github.io/gita-voice-bot-web/GroupedShlokas.html','_blank')">Grouped Shlokas</button>
            <button onclick="showConfusing()">Confusing Shlokas</button</button>
            <button id="showUvacha" onclick="showUvacha()">Uvacha</button>
         </div>
         <br>
         <div class="dropdown-container">
            <!-- Your original dropdowns unchanged -->
         </div>
      </div>

<script>
   const baseUrl = 'https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/main';
   const verseCounts = {1:47,2:72,3:43,4:42,5:29,6:47,7:30,8:28,9:34,10:42,11:55,12:20,13:34,14:27,15:20,16:24,17:28,18:78};
   let currentContext = [];
   let sessionId = 'session-' + Math.random().toString(36).substr(2,9);
   let englishSGSContent = '';
   let englishSringeriContent = '';
   let lastRandomIntent = null; // For continuous random play

   async function loadFiles() {
      try {
         const [sgs, sringeri] = await Promise.all([
            fetch('https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/main/englishSGS.txt'),
            fetch('https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/main/englishSringeri.txt')
         ]);
         englishSGSContent = await sgs.text();
         englishSringeriContent = await sringeri.text();
      } catch (e) { console.warn('English files not loaded'); }
   }

   async function fetchCombinedShlokaText(chapter, verse, style) {
      try {
         const langs = getSelectedLanguages();
         const texts = await Promise.all(langs.map(async lang => {
            if (lang === 'English') {
               const src = style === 'sgs' ? englishSGSContent : englishSringeriContent;
               const lines = src.replace(/\r\n/g, '\n').split('\n');
               for (let i = 0; i < lines.length; i++) {
                  if (lines[i].trim().match(new RegExp(`^${chapter}\\.${verse}|${chapter}-${verse}`))) {
                     let shloka = lines[i].replace(/^\d+[.-]\d+\s*/, '').trim();
                     i++;
                     while (i < lines.length && !/^\d+[.-]\d+/.test(lines[i])) {
                        shloka += '\n' + lines[i].trim();
                        i++;
                     }
                     return `${chapter}.${verse} (English):\n${shloka.trim()}`;
                  }
               }
               return `${chapter}.${verse} (English): Not found`;
            }
            const styleCap = style === 'sgs' ? 'SGS' : 'Sringeri';
            const url = `https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/refs/heads/main/BG_${lang}_${styleCap}.txt`;
            const resp = await fetch(url);
            if (!resp.ok) return `${chapter}.${verse} (${lang}): Not available`;
            const text = await resp.text();
            const lines = text.split('\n');
            for (let i = 0; i < lines.length; i++) {
               if (lines[i].trim().match(new RegExp(`^${chapter}\\.${verse}|${chapter}-${verse}`))) {
                  let shloka = lines[i].replace(/^\d+[.-]\d+\s*/, '').trim();
                  i++;
                  while (i < lines.length && !/^\d+[.-]\d+/.test(lines[i])) {
                     shloka += '\n' + lines[i].trim();
                     i++;
                  }
                  return `${chapter}.${verse} (${lang}):\n${shloka.trim()}`;
               }
            }
            return `${chapter}.${verse} (${lang}): Not found`;
         }));
         return texts.join('\n\n---\n\n');
      } catch (e) {
         return `Error: ${e.message}`;
      }
   }

   async function fetchAudioUrl(chapter, verse, quarter = null, isFull = false) {
      const style = getSelectedStyle();
      let folder = '';
      let filename = '';
      if (isFull) {
         folder = style === 'sringeri' ? 'AudioFullSringeri' : 'AudioFullSGS';
         filename = `${chapter}.${verse}.mp3`;
      } else if (quarter === 'pada1') {
         folder = 'AQ4PaadasSGS';
         filename = `Chapter ${chapter}/${verse}.1.mp3`;
      } else if (quarter === 'pada3') {
         folder = style === 'sringeri' ? 'AQ4PaadasSringeri' : 'AQ4PaadasSGS';
         filename = `Chapter ${chapter}/${verse}.3.mp3`;
      } else if (quarter === 'pada1_or_pada3') {
         folder = style === 'sringeri' ? 'AQ4PaadasSringeri' : 'AQ4PaadasSGS';
         const pada = Math.random() < 0.5 ? '1' : '3';
         filename = `Chapter ${chapter}/${verse}.${pada}.mp3`;
      }
      const url = `${baseUrl}/${folder}/${filename}`;
      try {
         const r = await fetch(url, { method: 'HEAD' });
         if (r.ok) return url;
      } catch {}
      return { error: 'Audio not available' };
   }

   function getSelectedStyle() {
      return document.querySelector('input[name="style"]:checked').value;
   }

   function getSelectedLanguages() {
      const map = {telugu:'Telugu', devanagari:'Devanagari', english:'English', kannada:'Kannada', tamil:'Tamil'};
      return Array.from(document.querySelectorAll('.language-group input:checked'))
                  .map(cb => map[cb.id]).filter(Boolean);
   }

   function updateTextboxVisibility() {
      const isSGS = document.getElementById('sgs').checked;
      document.getElementById('sgsText').classList.toggle('visible', isSGS);
      document.getElementById('sgsText').classList.toggle('hidden', !isSGS);
      document.getElementById('sringeriText').classList.toggle('visible', !isSGS);
      document.getElementById('sringeriText').classList.toggle('hidden', isSGS);
      document.getElementById('sgsLabel').classList.toggle('active', isSGS);
      document.getElementById('sringeriLabel').classList.toggle('active', !isSGS);
   }

   async function sendCommand(intent) {
      try {
         let chapter, verse, quarter = null, isFull = false, autoplay = true;

         if (intent === 'SGSFirstPaada') {
            document.getElementById('sgs').checked = true;
            updateTextboxVisibility();
            quarter = 'pada1';
            chapter = Math.floor(Math.random() * 18) + 1;
            verse = Math.floor(Math.random() * verseCounts[chapter]) + 1;
         } else if (intent === 'SringeriPaada') {
            quarter = 'pada1_or_pada3';
            chapter = Math.floor(Math.random() * 18) + 1;
            verse = Math.floor(Math.random() * verseCounts[chapter]) + 1;
         } else if (intent === 'ThirdPaada') {
            quarter = 'pada3';
            chapter = Math.floor(Math.random() * 18) + 1;
            verse = Math.floor(Math.random() * verseCounts[chapter]) + 1;
         } else if (intent === 'FullShloka' || intent === 'NextFullShloka' || intent === 'PreviousShloka') {
            const ctx = currentContext.find(c => c.name && c.name.includes('shloka-context'));
            chapter = ctx?.parameters?.chapter || 1;
            verse = ctx?.parameters?.verse || 1;
            if (intent === 'NextFullShloka') verse++;
            if (intent === 'PreviousShloka') verse--;
            if (verse < 1) { chapter--; verse = verseCounts[chapter] || 78; }
            if (verse > verseCounts[chapter]) { chapter++; verse = 1; }
            if (chapter < 1) chapter = 18;
            if (chapter > 18) chapter = 1;
            isFull = true;
         }

         currentContext = currentContext.filter(c => !c.name?.includes('shloka-context'));
         currentContext.push({ name: `projects/gita-voice-bot/agent/sessions/${sessionId}/contexts/shloka-context`, lifespanCount: 5, parameters: { chapter, verse, style: getSelectedStyle() } });
         localStorage.setItem('gitaContext', JSON.stringify(currentContext));

         const sgs = await fetchCombinedShlokaText(chapter, verse, 'sgs');
         const sringeri = await fetchCombinedShlokaText(chapter, verse, 'sringeri');
         document.getElementById('sgsText').innerText = sgs;
         document.getElementById('sringeriText').innerText = sringeri;

         const audioUrl = await fetchAudioUrl(chapter, verse, quarter, isFull);
         const player = document.getElementById('audioPlayer');
         if (audioUrl && !audioUrl.error) {
            player.src = audioUrl;
            player.load();
            if (autoplay) player.play();
         } else {
            document.getElementById('sgsText').innerText += '\n\nAudio not available';
            document.getElementById('sringeriText').innerText += '\n\nAudio not available';
         }

         updateTextboxVisibility();

         // NEW: Continuous Random Play
         player.onended = null;
         if (['SGSFirstPaada','SringeriPaada','ThirdPaada'].includes(intent)) {
            const cb = document.getElementById('continuousRandomPlayCheckbox');
            if (cb && cb.checked) {
               lastRandomIntent = intent;
               player.onended = async () => {
                  await new Promise(r => setTimeout(r, 60000));
                  if (document.getElementById('continuousRandomPlayCheckbox')?.checked) {
                     sendCommand(lastRandomIntent);
                  }
               };
            } else {
               lastRandomIntent = null;
            }
         } else {
            lastRandomIntent = null;
         }
      } catch (e) {
         console.error(e);
         document.getElementById('sgsText').innerText = 'Error: ' + e.message;
         document.getElementById('sringeriText').innerText = 'Error: ' + e.message;
      }
   }

   // Stop continuous play when unchecked
   document.addEventListener('DOMContentLoaded', () => {
      loadFiles();
      const cb = document.getElementById('continuousRandomPlayCheckbox');
      if (cb) {
         cb.addEventListener('change', () => {
            if (!cb.checked) {
               document.getElementById('audioPlayer').onended = null;
               lastRandomIntent = null;
            }
         });
      }
   });

   // === Theme toggle - keep this exactly as in your original ===
   const themeButtons = document.querySelectorAll('.theme-toggle button');
   const setTheme = (theme) => {
      document.documentElement.setAttribute('data-theme', theme);
      themeButtons.forEach(btn => {
         btn.classList.toggle('active', btn.dataset.theme === theme);
      });
      localStorage.setItem('theme', theme);
   };
   const savedTheme = localStorage.getItem('theme') || 'light';
   setTheme(savedTheme);
   themeButtons.forEach(button => {
      button.addEventListener('click', () => {
         setTheme(button.dataset.theme);
      });
   });

      // Initialize theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
            
            // Theme button event listeners
            themeButtons.forEach(button => {
               button.addEventListener('click', () => {
                   setTheme(button.dataset.theme);
               });
            });
            
            // Listen for system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
               if (document.documentElement.getAttribute('data-theme') === 'system') {
                   setTheme('system');
               }
            });       
</script>
   </body>
</html>
