<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bhagavad Gita Bot</title>
  <meta name="description" content="Explore Bhagavad Gita shlokas in Telugu with SGS and Sringeri styles, featuring audio recitations and meanings.">
  <meta name="keywords" content="Bhagavad Gita, SGS, Sringeri, Telugu shlokas, audio recitation, spiritual app">
  <meta name="author" content="Dr. P. Udayabhaskar">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://pubsaroja.github.io/bhagavad-gita-bot/">
  <link href="https://fonts.googleapis.com/css2?family=Ramabhadra&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Kannada&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil&display=swap" rel="stylesheet">
  <!-- Intro.js for elegant guided tours -->
  <link rel="stylesheet" href="https://unpkg.com/intro.js/minified/introjs.min.css">
  <script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>
  <style>
    /* Define CSS variables for theming */
    :root {
      --bg-color: #f0f0f0;
      --text-color: #2c3e50;
      --card-bg: #ffffff;
      --card-border: #357EC7;
      --button-bg: #357EC7;
      --button-text: #ffffff;
      --button-hover-bg: #1e40af;
      --header-color: #2c3e50;
      --subheader-color: #34495e;
      --input-border: #ccc;
      --modal-bg: #ffffff;
      --verse-button-bg: #f9f9f9;
      --verse-button-hover-bg: #e0e0e0;
      --intro-overlay: rgba(0,0,0,0.5);
      --intro-button-bg: #e5e7eb;
      --intro-button-text: #111827;
      --intro-tooltip-bg: #ffffff;
    }
    [data-theme="dark"] {
      --bg-color: #1a1a1a;
      --text-color: #ffffff;
      --card-bg: #2a2a2a;
      --card-border: #4a90e2;
      --button-bg: #4a90e2;
      --button-text: #ffffff;
      --button-hover-bg: #357abd;
      --header-color: #ffffff;
      --subheader-color: #cccccc;
      --input-border: #444;
      --modal-bg: #2a2a2a;
      --verse-button-bg: #333;
      --verse-button-hover-bg: #444;
      --intro-overlay: rgba(0,0,0,0.7);
      --intro-button-bg: #444;
      --intro-button-text: #ffffff;
      --intro-tooltip-bg: #333;
    }
    /* Global box-sizing for consistent sizing */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      font-family: Outfit, sans-serif;
      text-align: center;
      padding: 20px;
      margin: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      overflow-x: hidden;
      transition: all 0.3s ease;
    }
    h1 {
      color: var(--header-color);
      font-size: 1.5em;
    }
    h2 {
      color: var(--subheader-color);
      font-size: 1em;
      margin-top: 10px;
    }
    /* Theme toggle buttons */
    .theme-toggle {
      position: fixed;
      top: 10px;
      right: 10px; /* Changed to align to the right */
      display: flex;
      gap: 10px;
      z-index: 1001;
    }
    .theme-toggle button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 20px;
      color: var(--text-color);
      opacity: 0.6;
      transition: opacity 0.3s;
    }
    .theme-toggle button:hover,
    .theme-toggle button.active {
      opacity: 1;
    }
    /* Page frame */
    .page-frame {
      max-width: 900px;
      margin: 8px auto;
      padding: 12px;
      border: 2px solid var(--card-border);
      border-radius: 10px;
      background: var(--card-bg);
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    }
    @media (max-width: 600px) {
      .page-frame {
        margin: 4px;
        padding: 16px;
        border-radius: 10px;
        border-width: 4px;
        overflow: hidden;
      }
    }
    /* Top buttons container */
    .top-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      padding-left: 12px;
      padding-right: 12px;
      box-sizing: border-box;
    }
    .top-buttons button {
      width: 150px;
      height: 150px;
      border-radius: 25%;
      border: none;
      background-color: var(--button-bg);
      color: var(--button-text);
      font-size: 20px;
      cursor: pointer;
      transition: background 0.3s ease;
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
    }
    .top-buttons button.sgs-button:hover,
    .top-buttons button.sgs-button:active {
      background-image: url('https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/main/sankhu.png');
      background-color: transparent !important;
      color: transparent !important;
    }
    .top-buttons button.sringeri-button:hover,
    .top-buttons button.sringeri-button:active,
    .top-buttons button.third-paada-button:hover,
    .top-buttons button.third-paada-button:active {
      background-image: url('https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/main/chakra.png');
      background-color: transparent !important;
      color: transparent !important;
    }
    .top-buttons button.reset, .top-buttons button.reset:hover,
    .top-buttons button.reset:active, .top-buttons button.reset:focus {
      background: var(--button-bg) !important;
      color: var(--button-text) !important;
      background-image: none !important;
    }
    /* Button groups container */
    .button-groups {
      display: flex;
      justify-content: center;
      gap: 10px;
      max-width: 600px;
      margin: 0 auto;
      width: 100%;
      padding-left: 12px;
      padding-right: 12px;
      box-sizing: border-box;
    }
    .button-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 50%;
    }
    .button-groups button {
      background-color: var(--button-bg);
      color: var(--button-text);
      padding: 10px 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-family: 'Outfit', sans-serif;
      font-size: 1.6em;
      width: 100%;
      max-width: 150px;
      transition: background-color 0.3s ease;
    }
    .button-groups button:hover {
      background-color: var(--card-bg);
      color: transparent;
    }
    /* Dropdown container */
    .dropdown-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 600px;
      margin: 0 auto;
      border: 2px solid var(--card-border);
      border-radius: 5px;
      padding: 10px 12px;
      box-sizing: border-box;
    }
    .dropdown-item {
      display: flex;
      flex-direction: column;
    }
    .dropdown-label {
      margin-bottom: 6px;
      font-weight: bold;
      font-size: 1em;
      color: var(--header-color);
    }
    select {
      width: 100%;
      padding: 8px;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid var(--input-border);
      background-color: var(--card-bg);
      color: var(--text-color);
    }
    /* Shloka text */
    .shloka-text {
      margin-top: 10px;
      font-size: 1.5em;
      color: var(--text-color);
      white-space: pre-wrap;
      max-width: 100%;
      margin-left: 0;
      margin-right: 0;
      line-height: 1.5;
      min-height: 3em;
      overflow-y: auto;
      padding: 0;
      display: none;
      justify-content: center;
      align-items: center;
      text-align: center;
      font-family: 'Noto Sans Telugu', 'Noto Sans Devanagari', 'Noto Sans Kannada', 'Noto Sans Tamil', sans-serif;
      box-sizing: border-box;
    }
    .shloka-text.active {
      display: flex;
    }
    .shloka-text.active.multiline {
      display: block;
      text-align: left;
    }
    .shloka-number {
      font-weight: bold;
      margin-bottom: 5px;
      text-align: left;
      font-size: 1em;
    }
    .shloka-lines {
      text-align: left;
    }
    #sgsText, #sringeriText {
      display: block;
      width: 100%;
      white-space: normal !important;
      text-align: center;
      margin-left: 0;
      margin-right: 0;
      max-width: 100%;
      font-family: 'Noto Sans Telugu', 'Noto Sans Devanagari', 'Noto Sans Kannada', 'Noto Sans Tamil', sans-serif;
      font-size: 1.5em;
      line-height: 1.5;
      border: none;
      padding: 0;
      overflow-y: auto;
      min-height: 3em;
      box-sizing: border-box;
    }
    #sgsText > div,
    #sringeriText > div {
      display: block;
      width: 100%;
      margin-bottom: 1em;
    }
    .hidden {
      display: none !important;
    }
    .shloka-text.visible {
      display: flex !important;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .shloka-text.placeholder {
      display: flex !important;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .shloka-text.visible.multiline {
      display: block !important;
      text-align: left;
    }
    .visible {
      display: block !important;
    }
    #audioPlayer {
      margin: 10px auto;
      display: block;
      flex-shrink: 0;
    }
    .radio-group {
      margin: 10px 0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      width: 100%;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      padding-left: 12px;
      padding-right: 12px;
      box-sizing: border-box;
    }
    .radio-group label {
      margin: 0 10px;
      color: var(--text-color);
    }
    .radio-group input[type="text"] {
      padding: 8px;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid var(--input-border);
      background-color: var(--card-bg);
      color: var(--text-color);
    }
    .radio-group input[type="submit"] {
      background-color: var(--button-bg);
      color: var(--button-text);
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .radio-group input[type="submit"]:hover {
      background-color: var(--button-hover-bg);
    }

    .textbox-container {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 10px;
      width: 100%;
      max-width: 600px;
      margin: 12px auto 0;
      padding-left: 12px;
      padding-right: 12px;
      border: 2px solid var(--card-border);
      border-radius: 5px;
      box-sizing: border-box;
    }
    .textbox-container > div {
      width: 100%;
      max-width: 100%;
    }
    .textbox-label {
      font-weight: bold;
      margin-bottom: 5px;
      display: none;
      color: var(--header-color);
    }
    .textbox-label.active {
      display: block;
    }
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--intro-overlay);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: var(--modal-bg);
      padding: 20px;
      border-radius: 5px;
      max-width: 80%;
      max-height: 80%;
      overflow-y: auto;
      border: 2px solid var(--card-border);
    }
    .chapter-select {
      margin-bottom: 10px;
      padding: 10px;
      font-size: 1em;
      border-radius: 5px;
      width: 100%;
      max-width: 200px;
      background-color: var(--card-bg);
      color: var(--text-color);
      border: 1px solid var(--input-border);
    }

    /* Verse grid */
    .verse-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
      gap: 10px;
      padding: 10px;
    }
    .verse-button {
      background-color: var(--verse-button-bg);
      border: 1px solid var(--card-border);
      border-radius: 5px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      font-size: 0.9em;
      color: var(--text-color);
    }
    .verse-button:hover {
      background-color: var(--verse-button-hover-bg);
    }
    .close-button {
      background-color: #ff4444;
      color: white;
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      float: right;
    }
    .close-button:hover {
      background-color: #cc0000;
    }

    .credits {
      font-size: 0.9em;
      color: var(--text-color);
      margin-top: 10px;
    }

    /* Player container */
    .player-container {
      display: grid;
      grid-template-columns: repeat(3, max-content);
      grid-template-rows: repeat(2, auto);
      gap: 10px 5px;
      justify-content: center;
      justify-items: center;
      align-items: center;
      max-width: 600px;
      margin: 20px auto 0;
      width: 100%;
      box-sizing: border-box;
      border: none;
      border-radius: 5px;
      padding: 12px;
    }
    .player-container button {
      width: 100px;
      height: 40px;
      border: none;
      border-radius: 25px;
      background-color: var(--button-bg);
      color: var(--button-text);
      font-family: 'Outfit', sans-serif;
      font-size: 16px;
      cursor: pointer;
      padding: 0 15px;
      transition: background 0.3s ease;
      justify-self: center;
      align-self: center;
    }
    .player-container button:hover {
      background-color: var(--button-hover-bg);
    }

    /* Elegant Intro.js customization */
    .introjs-overlay {
      background: var(--intro-overlay);
    }
    .introjs-helperLayer {
      box-shadow: 0 8px 24px rgba(0,0,0,0.25);
      border-radius: 10px;
    }
    .introjs-tooltip {
      border-radius: 12px;
      font-family: Outfit, sans-serif;
      line-height: 1.4;
      color: var(--text-color);
      background-color: var(--intro-tooltip-bg);
    }
    .introjs-tooltip-header {
      border-bottom: none;
    }
    .introjs-tooltip-title {
      font-weight: 700;
      color: var(--header-color);
    }
    .introjs-tooltiptext {
      font-size: 15px;
    }
    .introjs-button {
      border-radius: 999px;
      padding: 6px 14px;
      border: none;
    }
    .introjs-skipbutton, .introjs-prevbutton {
      background: var(--intro-button-bg);
      color: var(--intro-button-text);
    }
    .introjs-nextbutton, .introjs-donebutton {
      background: var(--button-bg);
      color: var(--button-text);
    }
    /* Responsive mobile styles (≤600px) */
    @media (max-width: 600px) {
      body {
        padding: 6px;
      }
      .top-buttons,
      .button-groups,
      .dropdown-container,
      .radio-group,
      .player-container,
      .textbox-container {
        width: 100%;
        max-width: 100%;
        margin: 0 auto;
        padding-left: 12px;
        padding-right: 12px;
        box-sizing: border-box;
        flex-wrap: wrap;
      }
      .top-buttons {
        margin-top: 6px;
        gap: 5px;
        flex-direction: row;
      }
      .player-container {
        margin-top: 12px;
        padding-left: 12px;
        padding-right: 12px;
        grid-template-columns: repeat(3, 1fr);
      }
      .player-container button {
        width: 100%;
      }
      .shloka-text {
        font-size: 1.25em;
        padding: 0;
        text-align: left;
      }
      .shloka-number {
        font-weight: bold;
        margin-bottom: 5px;
        text-align: left;
        font-size: 1em;
        padding-left: 0;
      }
      #sgsText, #sringeriText {
        font-size: 1.25em;
        text-align: left;
        padding-left: 0;
        white-space: pre-line;
      }
      .shloka-text.visible,
      .shloka-text.placeholder {
        justify-content: flex-start;
        text-align: left;
      }
      .button-groups {
        margin-top: 12px;
        gap: 5px;
        flex-direction: row;
      }
      .button-group {
        width: 50%;
        gap: 5px;
      }
      .top-buttons button {
        flex: 1 1 calc(33.333% - 10px);
        max-width: none;
        height: auto;
        aspect-ratio: 1/1;
        font-size: 0.8em;
      }
      .button-groups button {
        padding: 6px 12px;
        font-size: 0.8em;
        max-width: 100%;
      }
    }
  </style>
</head>
<body>

<div class="theme-toggle">
  <button id="lightThemeBtn" class="active">Light</button>
  <button id="darkThemeBtn">Dark</button>
</div>

<div class="page-frame">

<p>Listen, understand and memorize Bhagavad Gita shlokas</p>

<div class="top-buttons">
  <button class="sgs-button"       onclick="sendCommand('SGSFirstPaada')">1st Paada<br>Only</button>
  <button class="sringeri-button"  onclick="sendCommand('SringeriPaada')">1st or 3rd Paada</button>
  <button class="third-paada-button" onclick="sendCommand('ThirdPaada')">3rd Paada<br>Only</button>
</div>

<audio id="audioPlayer" controls></audio>

<div class="radio-group">
  <label>Style:</label>
  <input type="radio" name="style" value="sgs" id="sgs" onchange="updateTextboxVisibility()">
  <label for="sgs">SGS</label>
  <input type="radio" name="style" value="sringeri" id="sringeri" checked onchange="updateTextboxVisibility()">
  <label for="sringeri">Sringeri</label>
</div>

<div class="player-container">
  <button onclick="sendCommand('PreviousShloka')">Previous</button>
  <button onclick="sendCommand('FullShloka')">Full</button>
  <button onclick="sendCommand('NextFullShloka')">Next</button>
</div>

<div class="radio-group language-group">
  <label>Languages:</label>
  <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-top:8px;">
    <label><input type="checkbox" name="language" value="te" id="telugu" checked> Telugu</label>
    <label><input type="checkbox" name="language" value="sa" id="devanagari"> Devanagari</label>
    <label><input type="checkbox" name="language" value="kn" id="kannada"> Kannada</label>
    <label><input type="checkbox" name="language" value="ta" id="tamil"> Tamil</label>
    <label><input type="checkbox" name="language" value="en" id="english"> English</label>
  </div>
</div>

<div class="textbox-container">
  <div>
    <div id="sgsLabel" class="textbox-label">SGS Style Shloka</div>
    <div id="sgsText" class="shloka-text hidden">Loading...</div>
  </div>
  <div>
    <div id="sringeriLabel" class="textbox-label active">Sringeri Style Shloka</div>
    <div id="sringeriText" class="shloka-text visible">Loading...</div>
  </div>
</div>

<div class="player-container">
  <button id="meaningsButton"   onclick="handleMeanings()">Meanings</button>
  <button onclick="showVerseTable()">Selector</button>
  <button id="instructionsButton" onclick="toggleInstructions()">Help</button>
  <button id="groupButton" onclick="window.open('https://pubsaroja.github.io/gita-voice-bot-web/GroupedShlokas.html','_blank')">Grouped Shlokas</button>
  <button onclick="showConfusing()">Confusing Shlokas</button>
  <button id="showUvacha" onclick="showUvacha()">Uvacha</button>
</div>

<br>

<div class="dropdown-container">
  <div class="dropdown-item">
    <label for="chapterSelect" class="dropdown-label">Random Shloka Chapterwise:</label>
    <select id="chapterSelect" onchange="handleChapterSelect(this)">
      <option value="" selected disabled>Select Chapter</option>
      <option value="1">1. అర్జునవిషాదయోగః</option>
      <option value="2">2. సాఙ్ఖ్యయోగః</option>
      <option value="3">3. కర్మయోగః</option>
      <option value="4">4. జ్ఞానయోగః</option>
      <option value="5">5. కర్మసన్న్యాసయోగః</option>
      <option value="6">6. ఆత్మసంయమయోగః</option>
      <option value="7">7. జ్ఞానవిజ్ఞానయోగః</option>
      <option value="8">8. అక్షరపరబ్రహ్మయోగః</option>
      <option value="9">9. రాజవిద్యారాజగుహ్యయోగః</option>
      <option value="10">10. విభూతియోగః</option>
      <option value="11">11. విశ్వరూపసన్దర్శనయోగః</option>
      <option value="12">12. భక్తియోగః</option>
      <option value="13">13. క్షేత్రక్షేత్రజ్ఞవిభాగయోగః</option>
      <option value="14">14. గుణత్రయవిభాగయోగః</option>
      <option value="15">15. పురుషోత్తమప్రాప్తియోగః</option>
      <option value="16">16. దైవాసురసమ్పద్విభాగయోగః</option>
      <option value="17">17. శ్రద్ధాత్రయవిభాగయోగః</option>
      <option value="18">18. మోక్షసన్న్యాసయోగః</option>
    </select>
  </div>

  <div class="dropdown-item">
    <label for="continuousPlaySelect" class="dropdown-label">Continuous Play:</label>
    <select id="continuousPlaySelect" onchange="handleContinuousPlay(this)">
      <option value="" selected disabled>Select Chapter</option>
      <option value="1">1. అర్జునవిషాదయోగః</option>
      <option value="2">2. సాఙ్ఖ్యయోగః</option>
      <option value="3">3. కర్మయోగః</option>
      <option value="4">4. జ్ఞానయోగః</option>
      <option value="5">5. కర్మసన్న్యాసయోగః</option>
      <option value="6">6. ఆత్మసంయమయోగః</option>
      <option value="7">7. జ్ఞానవిజ్ఞానయోగః</option>
      <option value="8">8. అక్షరపరబ్రహ్మయోగః</option>
      <option value="9">9. రాజవిద్యారాజగుహ్యయోగః</option>
      <option value="10">10. విభూతియోగః</option>
      <option value="11">11. విశ్వరూపసన్దర్శనయోగః</option>
      <option value="12">12. భక్తియోగః</option>
      <option value="13">13. క్షేత్రక్షేత్రజ్ఞవిభాగయోగః</option>
      <option value="14">14. గుణత్రయవిభాగయోగః</option>
      <option value="15">15. పురుషోత్తమప్రాప్తియోగః</option>
      <option value="16">16. దైవాసురసమ్పద్విభాగయోగః</option>
      <option value="17">17. శ్రద్ధాత్రయవిభాగయోగః</option>
      <option value="18">18. మోక్షసన్న్యాసయోగః</option>
    </select>
  </div>
</div>

<div>
  <h3>Search for word (Telugu or English or Number):</h3>
  <input type="text" id="search-input" placeholder="Enter word or number to search">
  <button id="search-button">Search</button>
</div>

<div class="credits">
  SGS Audio:<br>
  Pujya Sri Datta Vijayanand Teertha Swamiji<br>
  Sringeri Audio courtesy:<br>
  Smt Mathangi Kailasnath<br>
  Developed by<br>
  Dr. P. Udayabhaskar
</div>

<!-- Meaning Panel -->
<div id="meaningPanel" class="meaning-panel hidden">
  <strong>Word-by-word Meaning:</strong> [Loading...]<br>
  <strong>Overall Meaning:</strong> [Loading...]
</div>

<!-- Verse Table Modal -->
<div id="verseTableModal" class="modal">
  <div class="modal-content">
    <button class="close-button" onclick="closeVerseTable()">X</button>
    <select id="chapterTableSelect" class="chapter-select" onchange="updateVerseGrid()">
      <option value="" selected disabled>-- Select Chapter --</option>
      <option value="1">Chapter 1 (47 verses)</option>
      <option value="2">Chapter 2 (72 verses)</option>
      <option value="3">Chapter 3 (43 verses)</option>
      <option value="4">Chapter 4 (42 verses)</option>
      <option value="5">Chapter 5 (29 verses)</option>
      <option value="6">Chapter 6 (47 verses)</option>
      <option value="7">Chapter 7 (30 verses)</option>
      <option value="8">Chapter 8 (28 verses)</option>
      <option value="9">Chapter 9 (34 verses)</option>
      <option value="10">Chapter 10 (42 verses)</option>
      <option value="11">Chapter 11 (55 verses)</option>
      <option value="12">Chapter 12 (20 verses)</option>
      <option value="13">Chapter 13 (34 verses)</option>
      <option value="14">Chapter 14 (27 verses)</option>
      <option value="15">Chapter 15 (20 verses)</option>
      <option value="16">Chapter 16 (24 verses)</option>
      <option value="17">Chapter 17 (28 verses)</option>
      <option value="18">Chapter 18 (78 verses)</option>
    </select>
    <div id="verseTableContent" class="verse-grid"></div>
  </div>
</div>

</div> <!-- end .page-frame -->

<script>
  let selectedStyle = 'sringeri';
  let currentChapter = 1, currentVerse = 1;
  let isContinuousPlaying = false;
  let continuousQueue = [];
  let isShowingMeanings = false;
  let isLoading = false;

  const baseUrl = 'https://raw.githubusercontent.com/pubsaroja/bhagavad-gita-bot/main';
  const verseCounts = {1:47,2:72,3:43,4:42,5:29,6:47,7:30,8:28,9:34,10:42,11:55,12:20,13:34,14:27,15:20,16:24,17:28,18:78};

  const textFiles = {
    te: { sgs: 'BG_Telugu_SGS.txt', sringeri: 'BG_Telugu_Sringeri.txt' },
    sa: { sgs: 'BG_Devanagari_SGS.txt', sringeri: 'BG_Devanagari_Sringeri.txt' },
    kn: { sgs: 'BG_Kannada_SGS.txt', sringeri: 'BG_Kannada_Sringeri.txt' },
    ta: { sgs: 'BG_Tamil_SGS.txt', sringeri: 'BG_Tamil_Sringeri.txt' },
    en: 'BG_English_single_line.txt'
  };

  async function fetchShlokaText(chapter, verse, style, lang) {
    let url;
    if (lang === 'en') {
      url = `${baseUrl}/${textFiles.en}`;
    } else {
      const fname = textFiles[lang][style];
      url = `${baseUrl}/${fname}`;
    }
    try {
      const res = await fetch(url);
      if (!res.ok) return "Error loading text";
      const text = await res.text();
      const key = `${chapter}.${verse}`;
      const lines = text.split('\n');
      for (let line of lines) {
        if (line.trim().startsWith(key)) {
          return line.replace(/^[\d\.\-\s]+/, '').trim();
        }
      }
      return "Not found";
    } catch (e) {
      return "Failed to load";
    }
  }

  async function getShlokaText(chapter, verse, style) {
    const langs = [];
    if (document.getElementById('telugu').checked) langs.push('te');
    if (document.getElementById('devanagari').checked) langs.push('sa');
    if (document.getElementById('kannada').checked) langs.push('kn');
    if (document.getElementById('tamil').checked) langs.push('ta');
    if (document.getElementById('english').checked) langs.push('en');
    if (langs.length === 0) langs.push('te');

    const texts = await Promise.all(langs.map(l => fetchShlokaText(chapter, verse, style, l)));
    let output = '';
    langs.forEach((l, i) => {
      const langName = {te:'Telugu', sa:'Devanagari', kn:'Kannada', ta:'Tamil', en:'English'}[l];
      output += `${chapter}.${verse} (${langName})\n${texts[i]}\n\n`;
    });
    return output.trim();
  }

  async function fetchAudioUrl(chapter, verse, quarter, isFull) {
    const folder = selectedStyle === 'sgs' ? 'AQ4PaadasSGS' : 'AQ4PaadasSringeri';
    let pada = '';
    if (quarter === 'pada1') pada = '1';
    else if (quarter === 'pada3') pada = '3';
    else if (quarter === 'pada1_or_pada3') pada = Math.random() < 0.5 ? '1' : '3';

    if (isFull) {
      const fullFolder = selectedStyle === 'sgs' ? 'AudioFullSGS' : 'AudioFullSringeri';
      return `${baseUrl}/${fullFolder}/${chapter}.${verse}.mp3`;
    } else {
      return `${baseUrl}/${folder}/Chapter ${chapter}/${verse}.${pada}.mp3`;
    }
  }

  async function executeCommand(cmd) {
    if (isLoading) return;
    isLoading = true;

    let quarter = null;
    let isFull = false;
    let autoplay = true;

    if (cmd === 'SGSFirstPaada') {
      selectedStyle = 'sgs';
      quarter = 'pada1';
      currentChapter = Math.floor(Math.random() * 18) + 1;
      currentVerse = Math.floor(Math.random() * verseCounts[currentChapter]) + 1;
    } else if (cmd === 'SringeriPaada') {
      quarter = 'pada1_or_pada3';
      currentChapter = Math.floor(Math.random() * 18) + 1;
      currentVerse = Math.floor(Math.random() * verseCounts[currentChapter]) + 1;
    } else if (cmd === 'ThirdPaada') {
      quarter = 'pada3';
      currentChapter = Math.floor(Math.random() * 18) + 1;
      currentVerse = Math.floor(Math.random() * verseCounts[currentChapter]) + 1;
    } else if (cmd === 'FullShloka') {
      isFull = true;
    }

    const audioUrl = await fetchAudioUrl(currentChapter, currentVerse, quarter, isFull);
    playAudio(audioUrl);
    await updateShlokaText();
    isLoading = false;
  }

  function playAudio(url) {
    const audio = document.getElementById('audioPlayer');
    audio.src = url;
    audio.play().catch(() => {});
  }

  function navigate(cmd) {
    if (cmd === 'PreviousShloka') {
      if (currentVerse > 1) currentVerse--;
      else if (currentChapter > 1) { currentChapter--; currentVerse = verseCounts[currentChapter]; }
    } else if (cmd === 'NextFullShloka') {
      if (currentVerse < verseCounts[currentChapter]) currentVerse++;
      else if (currentChapter < 18) { currentChapter++; currentVerse = 1; }
    }
    executeCommand('FullShloka');
  }

  window.sendCommand = function(cmd) {
    if (cmd === 'PreviousShloka' || cmd === 'NextFullShloka') navigate(cmd);
    else executeCommand(cmd);
  };

  function updateTextboxVisibility() {
    const isSGS = document.getElementById('sgs').checked;
    selectedStyle = isSGS ? 'sgs' : 'sringeri';
    document.getElementById('sgsLabel').classList.toggle('active', isSGS);
    document.getElementById('sringeriLabel').classList.toggle('active', !isSGS);
    document.getElementById('sgsText').classList.toggle('visible', isSGS);
    document.getElementById('sgsText').classList.toggle('hidden', !isSGS);
    document.getElementById('sringeriText').classList.toggle('visible', !isSGS);
    document.getElementById('sringeriText').classList.toggle('hidden', isSGS);
  }

  function handleMeanings() {
    const panel = document.getElementById('meaningPanel');
    panel.classList.toggle('hidden');
    if (!panel.classList.contains('hidden')) {
      panel.innerHTML = `<strong>Word-by-word:</strong> ధృతరాష్ట్ర: = Dhritarashtra...<br><strong>Overall Meaning:</strong> Dhritarashtra asks about the war...`;
    }
  }

  function toggleInstructions() {
    alert("Click 'Full' to play. Use radio to switch style. 'Selector' opens verse grid. 'Meanings' shows explanation.");
  }

  function showVerseTable() { document.getElementById('verseTableModal').style.display = 'flex'; }
  function closeVerseTable() { document.getElementById('verseTableModal').style.display = 'none'; }

  function updateVerseGrid() {
    const ch = document.getElementById('chapterTableSelect').value;
    if (!ch) return;
    const count = verseCounts[ch];
    const container = document.getElementById('verseTableContent');
    container.innerHTML = '';
    for (let i = 1; i <= count; i++) {
      const btn = document.createElement('button');
      btn.className = 'verse-button';
      btn.textContent = i;
      btn.onclick = () => {
        currentChapter = parseInt(ch);
        currentVerse = i;
        sendCommand('FullShloka');
        closeVerseTable();
      };
      container.appendChild(btn);
    }
  }

  async function handleChapterSelect(sel) {
    const ch = sel.value;
    const verse = Math.floor(Math.random() * verseCounts[ch]) + 1;
    currentChapter = parseInt(ch);
    currentVerse = verse;
    await executeCommand('FullShloka');
  }

  async function handleContinuousPlay(sel) {
    const ch = sel.value;
    isContinuousPlaying = true;
    continuousQueue = Array.from({length: verseCounts[ch]}, (_, i) => ({ch: parseInt(ch), vs: i+1}));
    currentChapter = parseInt(ch);
    currentVerse = 1;
    await executeCommand('FullShloka');
    setTimeout(playNextInQueue, 12000);
  }

  async function playNextInQueue() {
    if (!isContinuousPlaying || continuousQueue.length === 0) { isContinuousPlaying = false; return; }
    const next = continuousQueue.shift();
    currentChapter = next.ch;
    currentVerse = next.vs;
    await executeCommand('FullShloka');
    setTimeout(playNextInQueue, 12000);
  }

  function showConfusing() {
    const groups = [['1.24','2.9','11.9'], ['2.10','1.21']];
    const group = groups[Math.floor(Math.random() * groups.length)];
    const [ch, vs] = group[0].split('.');
    currentChapter = parseInt(ch); currentVerse = parseInt(vs);
    sendCommand('FullShloka');
  }

  function showUvacha() {
    const uvacha = ['1.1', '2.1', '11.1'];
    const [ch, vs] = uvacha[Math.floor(Math.random() * uvacha.length)].split('.');
    currentChapter = parseInt(ch); currentVerse = parseInt(vs);
    sendCommand('FullShloka');
  }

  document.getElementById('lightThemeBtn').onclick = () => {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('lightThemeBtn').classList.add('active');
    document.getElementById('darkThemeBtn').classList.remove('active');
  };
  document.getElementById('darkThemeBtn').onclick = () => {
    document.documentElement.setAttribute('data-theme', 'dark');
    document.getElementById('darkThemeBtn').classList.add('active');
    document.getElementById('lightThemeBtn').classList.remove('active');
  };

  document.addEventListener('DOMContentLoaded', () => {
    executeCommand('FullShloka');
  });
</script>

</div> <!-- end .page-frame -->

</body>
</html>
